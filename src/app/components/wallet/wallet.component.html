<!-- Header superior -->
<div class="dashboard-header">
  <div class="dashboard-controls">
    <button mat-icon-button (click)="toggleAmountVisibility()"
      [matTooltip]="hideAmounts() ? 'Mostrar montos' : 'Ocultar montos'" class="visibility-btn" [disabled]="loading()">
      <mat-icon>{{ hideAmounts() ? 'visibility' : 'visibility_off' }}</mat-icon>
    </button>

    <div class="refresh-section">
      <span class="text-muted">Ãšltima actualizaciÃ³n: {{ lastUpdated() | date:'M/d/yy, h:mm a' }}</span>
      <button mat-icon-button (click)="refreshData()" matTooltip="Actualizar datos" [disabled]="loading()">
        <mat-icon [class.spinning]="loading()">refresh</mat-icon>
      </button>
    </div>
  </div>
</div>

<div class="dashboard-layout">
  <!-- Columna izquierda - GrÃ¡fico evoluciÃ³n + Billetera/Torta -->
  <div class="wallet-section">
    <!-- GrÃ¡fico de evoluciÃ³n - PRIMERA COLUMNA -->
    <app-wallet-evolution-chart [chartData]="walletHistoryData()" [hideAmounts]="hideAmounts()" [isLoading]="loading()"
      [refreshTrigger]="refreshTrigger()" class="evolution-chart">
    </app-wallet-evolution-chart>

    <!-- Total de billetera + GrÃ¡fico categorÃ­as - SEGUNDA COLUMNA -->
    <div class="wallet-summary-column">
      <mat-card class="total-card">
        @if (loading()) {
        <!-- Estado de carga -->
        <div class="skeleton-content">
          <div class="skeleton-title"></div>
          <div class="skeleton-amount"></div>
          <div class="skeleton-chart"></div>
        </div>
        } @else if (error()) {
        <!-- Estado de error -->
        <div class="error-content">
          <mat-icon class="error-icon-small">error_outline</mat-icon>
          <span>Error al cargar</span>
        </div>
        } @else {
        <!-- Contenido normal -->
        <div class="summary-content">
          <!-- TÃ­tulo de la card arriba del monto -->
          <div class="card-title">
            <span class="summary-title">ðŸ’° TOTAL BILLETERA</span>
          </div>

          <!-- Total Amount centrado -->
          <div class="total-amount-container">
            <div class="total-amount" [class.hidden-amount]="hideAmounts()">
              {{ hideAmounts() ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' : (totalWallet() | currencyFormat:'USD') }}
            </div>
          </div>

          <!-- GrÃ¡fico de categorÃ­as centrado -->
          @if (categories() && categories().length > 0) {
          <div class="categories-chart-section">
            <app-wallet-categories-chart [categories]="categories()" [hideAmounts]="hideAmounts()">
            </app-wallet-categories-chart>
          </div>
          }
        </div>
        }
      </mat-card>
    </div>
  </div>

  <!-- Columna derecha - Cards de rendimiento -->
  <div class="performance-section">
    <div class="performance-cards">
      <app-wallet-performance-card *ngFor="let category of performanceCardsData(); trackBy: trackByIndex"
        [data]="category" [hideAmounts]="hideAmounts()" [isLoading]="loading()" [hasError]="!!error()">
      </app-wallet-performance-card>
    </div>
  </div>
</div>